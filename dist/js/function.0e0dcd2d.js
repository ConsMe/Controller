(function(t){function e(e){for(var i,s,o=e[0],c=e[1],u=e[2],d=0,v=[];d<o.length;d++)s=o[d],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&v.push(a[s][0]),a[s]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);r&&r(e);while(v.length)v.shift()();return l.push.apply(l,u||[]),n()}function n(){for(var t,e=0;e<l.length;e++){for(var n=l[e],i=!0,o=1;o<n.length;o++){var c=n[o];0!==a[c]&&(i=!1)}i&&(l.splice(e--,1),t=s(s.s=n[0]))}return t}var i={},a={function:0},l=[];function s(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=i,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(n,i,function(e){return t[e]}.bind(null,i));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var u=0;u<o.length;u++)e(o[u]);var r=c;l.push([0,"chunk-vendors","chunk-common"]),n()})({0:function(t,e,n){t.exports=n("55b7")},"0551":function(t,e,n){},1892:function(t,e,n){"use strict";n("3ef1")},"1a00":function(t,e,n){"use strict";n("0551")},"3ef1":function(t,e,n){},"497b":function(t,e,n){"use strict";n("b989")},"55b7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("2b0e"),a=n("e37d"),l=n("a65d"),s=n.n(l),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("left-side-bar"),n("header-comp"),n("functions")],1)},c=[],u=(n("10cc"),n("5a2e"),n("a725"),n("0a28")),r=n("0418"),d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("main",{staticClass:"function"},[n("popup-add",{attrs:{showPopupAddTrigger:t.showPopupAddTrigger},on:{newFunc:t.addFunc}}),n("popup-delete",{attrs:{showPopupDelTrigger:t.showPopupDelTrigger,index:t.deleteFuncIndex},on:{del:t.delFunc}}),n("div",{staticClass:"function__top"},[n("div",{staticClass:"function__title title"},[t._v("Функции")]),n("div",{staticClass:"function__button button1",on:{click:t.openAddPopup}},[t._v(" Добавить ")])]),n("div",{staticClass:"function__content"},t._l(t.funcsInit,(function(e,i){return n("div",{directives:[{name:"show",rawName:"v-show",value:e&&!e.isDeleted,expression:"init && !init.isDeleted"}],key:i,staticClass:"function__row"},[n("div",{staticClass:"function__hed",on:{click:function(n){return t.toggleVisibility(e)}}},[n("div",{staticClass:"function__name"},[t._v(" "+t._s(t.funcsNames[i])+" ")]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.funcsNames[i],expression:"funcsNames[i]"}],staticClass:"function__rename",attrs:{type:"text",name:"name"},domProps:{value:t.funcsNames[i]},on:{input:function(e){e.target.composing||t.$set(t.funcsNames,i,e.target.value)}}}),n("div",{staticClass:"function__btt"},[n("div",{staticClass:"function__svg function__svg_dis"},[n("edit-img")],1),n("div",{staticClass:"function__svg",on:{click:function(e){return e.stopPropagation(),t.showPopupDel(i)}}},[n("delete-img")],1),n("div",{staticClass:"function__svg"},[n("expand-img")],1)])]),n("div",[n("function",{attrs:{init:t.canApply?e:null,objects:t.objects,allDevices:t.allDevices,isVisible:!!e&&t.visibility[e.fname],name:e?e.fname:"",index:i,hasNoFloat:t.hasNoFloat,ext:t.ext}})],1)])})),0)],1)},v=[],h=(n("cb29"),n("4de4"),n("c740"),n("4160"),n("caad"),n("d81d"),n("b64b"),n("2532"),n("159b"),n("ade3")),p=n("bc3a"),f=n.n(p),b=[{value:"ibin",label:"Дискретный вход",devName:"ibin"},{value:"obin",label:"Дискретный выход",devName:"obin"},{value:"orly",label:"Реле",devName:"orly"},{value:"iadc",label:"Аналоговый вход",devName:"iadc"},{value:"opwm",label:"ШИМ выход",devName:"opwm"},{value:"odac",label:"Аналоговый выход",devName:"odac"},{value:"ibtn",label:"Кнопка 1-wire-1",devName:"ibtn"},{value:"ikey",label:"Ключ доступа 1-wire-2",devName:"ikey"},{value:"itmp",label:"Термометр 1-wire-3",devName:"itmp"},{value:"obtn",label:"Выход кнопки 1-wire-1",devName:"obtn"},{value:"var",label:"Внутренняя переменная"},{value:"time",label:"Часы"}],m=n("ab4f"),g=n("a786"),_=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("svg",{attrs:{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[n("path",{attrs:{d:"M15.7151 3.50826C16.2801 4.09782 16.2893 5.05067 15.7359 5.65205L9.77623 12.1282C9.50686 12.4209 9.13717 12.5901 8.74834 12.5986L6.24384 12.6535L6.2967 10.0245C6.30467 9.62803 6.45973 9.25021 6.72925 8.97058L12.822 2.64921C13.3957 2.05402 14.3227 2.05541 14.8948 2.65231L15.7151 3.50826Z",fill:"#314F57"}}),n("path",{attrs:{opacity:"0.4",d:"M9.675 1.5C10.0892 1.5 10.425 1.83579 10.425 2.25C10.425 2.66421 10.0892 3 9.675 3H4.5C3.67157 3 3 3.67157 3 4.5V13.5C3 14.3284 3.67157 15 4.5 15H13.5C14.3284 15 15 14.3284 15 13.5V9.75C15 9.33579 15.3358 9 15.75 9C16.1642 9 16.5 9.33579 16.5 9.75V13.5C16.5 15.1569 15.1569 16.5 13.5 16.5H4.5C2.84315 16.5 1.5 15.1569 1.5 13.5V4.5C1.5 2.84315 2.84315 1.5 4.5 1.5H9.675Z",fill:"#314F57"}})])},y=[],j=n("2877"),w={},x=Object(j["a"])(w,_,y,!1,null,null,null),C=x.exports,k=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("svg",{attrs:{width:"29",height:"29",viewBox:"0 0 29 29",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[n("rect",{attrs:{width:"19.6682",height:"2.45853",rx:"1.22926",transform:"matrix(0.691886 -0.722007 0.691925 0.72197 6.50098 20.3086)",fill:"#314F57"}}),n("rect",{attrs:{opacity:"0.3",width:"19.6682",height:"2.45853",rx:"1.22926",transform:"matrix(0.691886 0.722006 -0.691925 0.72197 8.20117 6.10742)",fill:"#314F57"}})])},O=[],N={},D=Object(j["a"])(N,k,O,!1,null,null,null),E=D.exports,$=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("svg",{attrs:{width:"16",height:"8",viewBox:"0 0 16 8",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[n("path",{attrs:{d:"M8.00002 5.62586L1.73312 0.177181C1.41628 -0.0896287 0.943143 -0.0490732 0.676333 0.267763C0.409524 0.5846 0.450078 1.05774 0.766915 1.32455L7.25433 7.16716C7.69112 7.53499 8.33419 7.51723 8.75002 7.12586L15.264 1.29701C15.5657 1.01313 15.5801 0.538472 15.2962 0.236841C15.0123 -0.0647888 14.5376 -0.0791721 14.236 0.204715L8.00002 5.62586Z",fill:"#314F57"}})])},F=[],A={},S=Object(j["a"])(A,$,F,!1,null,null,null),T=S.exports,P=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"show",rawName:"v-show",value:t.isVisible,expression:"isVisible"}],staticClass:"function__seting",staticStyle:{display:"block"}},[n("trigger",{attrs:{objects:t.objects,allDevices:t.allDevices,init:t.init},on:{change:function(e){return t.$set(t.func,"trigger",e)}}}),n("conditions",{attrs:{objects:t.objects,allDevices:t.allDevices,init:t.init},on:{change:function(e){return t.$set(t.func,"conditions",e)},changeLogic:function(e){return t.$set(t.func,"logic",e)}}}),n("actions",{attrs:{objects:t.objects,allDevices:t.allDevices,init:t.init},on:{change:function(e){return t.$set(t.func,"actions",e)}}}),n("div",{staticClass:"function__bottom"},[n("div",{staticClass:"function__btt1 button0",on:{click:t.loadJSON}},[t._v(" Экспорт в JSON ")]),n("div",{staticClass:"function__btt2 button1",class:{"dsbl-btn":t.disabled},on:{click:t.save}},[t._v(" Сохранить параметры ")])])],1)},I=[],L=(n("b0c0"),n("d3b7"),n("3ca3"),n("ddb0"),n("2b3d"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"function__row2"},[n("div",{staticClass:"function__row-name"},[t._v("Триггер и тип события")]),n("div",{staticClass:"function__in"},[n("object-block",{attrs:{objects:t.objects,allDevices:t.allDevices,init:t.init?t.init.trigger.object:null},on:{change:function(e){t.trigger.object=e}}}),n("event-block",{attrs:{init:t.init,object:t.trigger.object},on:{change:t.change}})],1)])}),V=[],H=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"obj-block"},[n("custom-select",{staticClass:"select1",attrs:{options:t.objects,valueInit:t.type,header:"Тип объекта"},on:{change:function(e){t.type=e}}}),t.devices.length?n("custom-select",{staticClass:"select1 mini",attrs:{options:t.devices,valueInit:t.device,header:"Блок"},on:{change:t.setDevice}}):t._e(),t.devices.length||"var"===t.type?n("custom-select",{staticClass:"select1 mini",attrs:{options:t.addrs,valueInit:t.addr,header:t.addressInputName},on:{change:function(e){t.addr=e}}}):t._e()],1)},M=[],B=(n("7db0"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t.isMobile?n("div",{staticClass:"select-native",staticStyle:{width:"100%"}},[n("select",{directives:[{name:"model",rawName:"v-model",value:t.value,expression:"value"}],class:{"not-in-list":!t.optionsHaveValue},on:{change:[function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.value=e.target.multiple?n:n[0]},function(e){return t.$emit("change",t.value)}]}},t._l(t.allOptions,(function(e,i){return n("option",{key:i,attrs:{disabled:null===e.value},domProps:{value:e.value}},[t._v(" "+t._s(e.label)+" ")])})),0)]):n("div",{staticClass:"custom-select"},[n("div",{staticClass:"select-selected select-arrow-active",class:{"not-in-list":!t.optionsHaveValue},attrs:{title:t.optionsHaveValue?null:t.notInListMessage},on:{click:function(e){return e.stopPropagation(),t.showHide(e)}}},[t._v(" "+t._s(t.selectedLabel)+" ")]),n("div",{directives:[{name:"show",rawName:"v-show",value:t.isShown,expression:"isShown"}],staticClass:"select-items"},t._l(t.allOptions,(function(e,i){return n("div",{key:i,class:{selected:t.value===e.value,disabled:null===e.value},on:{click:function(n){n.stopPropagation(),null!==e.value&&t.setValue(e)}}},[t._v(" "+t._s(e.label)+" ")])})),0)])])}),J=[],W=(n("99af"),n("2909")),Z={props:["options","valueInit","header"],data:function(){return{isMobile:window.innerWidth<670,value:null,isShown:!1,dopOption:null,notInListMessage:"Данный параметр уже устарел, из-за чего эта функция может не работать"}},computed:{optionsHaveValue:function(){var t=this;if(null!==this.value){var e=this.options.find((function(e){return e.value===t.value}));if(!e)return!1}return!0},allOptions:function(){var t=this.header?[{value:null,label:this.header}].concat(Object(W["a"])(this.options)):this.options;return this.optionsHaveValue?t:[].concat(Object(W["a"])(t),[{value:this.value,label:this.value}])},selectedLabel:function(){var t=this,e=this.allOptions.find((function(e){return e.value===t.value}));return e?e.label:null}},watch:{valueInit:{handler:function(t){this.value=t},immediate:!0}},created:function(){var t=this;document.addEventListener("click",(function(){t.isShown=!1}))},methods:{setValue:function(t){this.value=t.value,this.isShown=!1,this.$emit("change",t.value)},showHide:function(){this.isShown=!this.isShown}}},R=Z,U=(n("497b"),Object(j["a"])(R,B,J,!1,null,"6c714c28",null)),q=U.exports,z={props:["init","objects","allDevices","index"],components:{CustomSelect:q},data:function(){return{type:null,device:null,addr:null,hasComlplexAddr:m["a"]}},computed:{objectFull:function(){var t=this,e=this.type?this.objects.find((function(e){return e.value===t.type})):null;return e?this.clone(e):null},devices:function(){return this.objectFull&&this.objectFull.devices?this.objectFull.devices:[]},addrs:function(){var t=this;if("var"===this.type)return new Array(33).fill({}).map((function(t,e){return{value:e,label:e+1}}));if(null===this.device)return[];var e=this.allDevices.find((function(e){return e.addr===t.device})),n=this.objectFull.devName;return e&&e[n]?this.hasComlplexAddr.includes(n)?e[n].map((function(t){return{label:t.label,value:t.value}})):new Array(e[n]).fill({}).map((function(n,i){return{value:i,label:e.label&&e.label[t.type]&&e.label[t.type][i]&&e.label[t.type][i].length?e.label[t.type][i]:i+1}})):[]},obj:function(){return{type:this.type,device:this.device,addr:this.addr}},addressInputName:function(){return"var"===this.type?"Номер":this.hasComlplexAddr.includes(this.type)?"Адрес":"Вход/выход"}},watch:{devices:function(t){var e=this;if(null!==this.device){var n=t.find((function(t){return t.value===e.device}));n||(this.device=null)}},obj:{handler:function(t){this.$emit("change",t)},deep:!0},device:function(t){null===t&&(this.addr=null)},init:{handler:function(t){t&&(this.type=t.type,this.device=t.device,this.addr=t.addr)},deep:!0,immediate:!0}},methods:{setDevice:function(t){var e=this;if(this.device=t,null!==this.addr){var n=this.addrs.find((function(t){return t.value===e.addr}));n||(this.addr=null)}}}},G=z,K=(n("1a00"),Object(j["a"])(G,H,M,!1,null,null,null)),Q=K.exports,X=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"event-block"},[t.events.length?n("custom-select",{staticClass:"select1",attrs:{options:t.events,valueInit:t.event.event,header:"Тип события"},on:{change:t.change}}):t._e(),t._l(t.params,(function(e,i){return n("input",{directives:[{name:"tooltip",rawName:"v-tooltip",value:e.label,expression:"param.label"},{name:"model",rawName:"v-model",value:t.event[e.value],expression:"event[param.value]"}],key:i,staticClass:"inputs__inp input",attrs:{type:"text",placeholder:e.label},domProps:{value:t.event[e.value]},on:{input:function(n){n.target.composing||t.$set(t.event,e.value,n.target.value)}}})}))],2)},Y=[],tt=[{objectTypes:["ibin","ibtn","obin","orly","obtn","ikey"],events:[{value:">",label:"По переднему фронту"},{value:"<",label:"По заднему фронту"}]},{objectTypes:["iadc","opwm","odac","itmp","var"],events:[{value:">",label:"Превышение порога",params:[{value:"value",label:"Порог"}]},{value:"<",label:"Падение ниже порога",params:[{value:"value",label:"Порог"}]},{value:"><",label:"Вход в диапазон",params:[{value:"min",label:"Нижняя граница"},{value:"max",label:"Верхняя граница"}]},{value:"<>",label:"Выход из диапазона",params:[{value:"min",label:"Нижняя граница"},{value:"max",label:"Верхняя граница"}]},{value:"==",label:"По достижении значения",params:[{value:"value",label:"Значение"}]},{value:"+-",label:"Любое изменение"},{value:"--",label:"Сохранение значения"}]},{objectTypes:["time"],events:[{value:"at",label:"В заданное время",params:[{value:"time",label:"Время"},{value:"date",label:"Дата"},{value:"tmsk",label:"Время, маска"},{value:"dmsk",label:"Дата, маска"}]},{value:"><",label:"Вход в интервал",params:[{value:"time",label:"Время от"},{value:"date",label:"Дата от"},{value:"tmsk",label:"Время от, маска"},{value:"dmsk",label:"Дата от, маска"},{value:"time2",label:"Время до"},{value:"date2",label:"Дата до"}]},{value:"<>",label:"Выход из интервала",params:[{value:"time",label:"Время от"},{value:"date",label:"Дата от"},{value:"tmsk",label:"Время от, маска"},{value:"dmsk",label:"Дата от, маска"},{value:"time2",label:"Время до"},{value:"date2",label:"Дата до"}]}]}],et={props:["init","object"],components:{CustomSelect:q},data:function(){return{event:{event:null,value:null,min:null,max:null,time:null,date:null,tmsk:null,dmsk:null,time2:null,date2:null}}},computed:{trigger:function(){var t=this;return this.object&&this.object.type?tt.find((function(e){return e.objectTypes.includes(t.object.type)})):null},events:function(){return this.trigger?this.trigger.events:[]},params:function(){var t=this;if(null===this.event.event)return[];var e=this.events.find((function(e){return e.value===t.event.event}));return e&&e.params?e.params:[]}},watch:{event:{handler:function(){var t=this.clone(this.event);Object.keys(t).forEach((function(e){["event","tmsk","dmsk"].includes(e)||null===t[e]||(t[e]=parseFloat(t[e]))})),this.$emit("change",t)},deep:!0},events:function(t){var e=this;if(null!==this.event.event){var n=t.find((function(t){return t.value===e.event.event}));n&&n.label===this.event.event||(this.event.event=null)}},init:function(t){var e=this;if(t){if(!("event"in t.trigger)||!t.trigger.event.length)return;this.event.event=t.trigger.event,["value","min","max","time","date","tmsk","dmsk","time2","date2"].forEach((function(n){n in t.trigger&&(e.event[n]=t.trigger[n])}))}}},methods:{change:function(t){var e=this;this.event.event=t,Object.keys(this.event).forEach((function(t){"event"!==t&&(e.event[t]=null)}))}}},nt=et,it=(n("65d3"),Object(j["a"])(nt,X,Y,!1,null,null,null)),at=it.exports,lt={props:["init","objects","allDevices"],components:{ObjectBlock:Q,EventBlock:at},data:function(){return{trigger:{object:null,event:null,value:null,min:null,max:null,time:null,date:null,tmsk:null,dmsk:null,time2:null,date2:null}}},watch:{trigger:{handler:function(t){this.$emit("change",this.clone(t))},deep:!0}},methods:{change:function(t){var e=this;Object.keys(t).forEach((function(n){e.trigger[n]=t[n]}))}}},st=lt,ot=Object(j["a"])(st,L,V,!1,null,null,null),ct=ot.exports,ut=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"function__row2"},[n("div",{staticClass:"function__row-name"},[t._v("Условие")]),n("div",{staticClass:"function__in"},[n("custom-select",{staticClass:"select1",attrs:{options:t.logics,valueInit:t.logic},on:{change:function(e){t.logic=e}}})],1),null!==t.logic?[t._l(t.conditions,(function(e,i){return n("condition",{key:i,attrs:{objects:t.objects,allDevices:t.allDevices,init:t.init.conditions[i],index:i},on:{change:function(e){return t.setCondition(i,e)}}})})),n("div",{staticClass:"function__btt1 button0",staticStyle:{"margin-top":"15px","padding-top":"10px",display:"block"},on:{click:t.addCondition}},[t._v(" Добавить условие ")]),t.conditions.length?n("div",{staticClass:"function__btt1 button0",staticStyle:{"margin-top":"15px","padding-top":"10px",display:"block"},on:{click:t.deleteCondition}},[t._v(" Удалить условие ")]):t._e()]:t._e()],2)},rt=[],dt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"function__in"},[n("object-block",{attrs:{objects:t.objects,allDevices:t.allDevices,init:t.init?t.init.object:null,index:t.index},on:{change:function(e){t.object=e}}}),n("cond",{attrs:{init:t.initCond,object:t.object},on:{change:t.change}})],1)},vt=[],ht=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"cond-block"},[t.conds.length?n("custom-select",{staticClass:"select1",attrs:{options:t.conds,valueInit:t.cond.cond,header:"Тип проверки"},on:{change:t.change}}):t._e(),t._l(t.params,(function(e,i){return n("input",{directives:[{name:"tooltip",rawName:"v-tooltip",value:e.label,expression:"param.label"},{name:"model",rawName:"v-model",value:t.cond[e.value],expression:"cond[param.value]"}],key:i,staticClass:"inputs__inp input",attrs:{type:"text",placeholder:e.label},domProps:{value:t.cond[e.value]},on:{input:function(n){n.target.composing||t.$set(t.cond,e.value,n.target.value)}}})}))],2)},pt=[],ft=[{objectTypes:["ibin","ibtn","obin","orly","obtn","ikey"],conds:[{value:"1",label:"Активен"},{value:"0",label:"Неактивен"}]},{objectTypes:["iadc","opwm","odac","itmp","var"],conds:[{value:">",label:"Больше",params:[{value:"value",label:"Значение"}]},{value:"<",label:"Меньше",params:[{value:"value",label:"Значение"}]},{value:">=",label:"Больше или равно",params:[{value:"value",label:"Значение"}]},{value:"<=",label:"Меньше или равно",params:[{value:"value",label:"Значение"}]},{value:"==",label:"Равно",params:[{value:"value",label:"Значение"}]},{value:"!=",label:"Не равно",params:[{value:"value",label:"Значение"}]},{value:"><",label:"В диапазоне",params:[{value:"min",label:"Нижняя граница"},{value:"max",label:"Верхняя граница"}]},{value:"<>",label:"Вне диапазона",params:[{value:"min",label:"Нижняя граница"},{value:"max",label:"Верхняя граница"}]}]},{objectTypes:["time"],conds:[{value:"><",label:"В интервале",params:[{value:"time",label:"Время от"},{value:"date",label:"Дата от"},{value:"tmsk",label:"Время от, маска"},{value:"dmsk",label:"Дата от, маска"},{value:"time2",label:"Время до"},{value:"date2",label:"Дата до"}]},{value:"<>",label:"Вне интервала",params:[{value:"time",label:"Время от"},{value:"date",label:"Дата от"},{value:"tmsk",label:"Время от, маска"},{value:"dmsk",label:"Дата от, маска"},{value:"time2",label:"Время до"},{value:"date2",label:"Дата до"}]}]}],bt={props:["init","object"],components:{CustomSelect:q},data:function(){return{cond:{cond:null,value:null,min:null,max:null,time:null,date:null,tmsk:null,dmsk:null,time2:null,date2:null}}},computed:{condition:function(){var t=this;return this.object&&this.object.type?ft.find((function(e){return e.objectTypes.includes(t.object.type)})):null},conds:function(){return this.condition?this.condition.conds:[]},params:function(){var t=this;if(null===this.cond.cond)return[];var e=this.conds.find((function(e){return e.value===t.cond.cond}));return e&&e.params?e.params:[]}},watch:{cond:{handler:function(){var t=this;null===this.cond.cond&&Object.keys(this.cond).forEach((function(e){t.cond[e]=null}));var e=this.clone(this.cond);Object.keys(e).forEach((function(t){["cond","tmsk","dmsk"].includes(t)||null===e[t]||(e[t]=parseFloat(e[t]))})),this.$emit("change",e)},deep:!0},conds:function(t){var e=this;if(null!==this.cond.cond){var n=t.find((function(t){return t.value===e.cond.cond}));n&&n.value===this.cond.cond||(this.cond.cond=null)}},init:{handler:function(t){Object.assign(this.cond,t)},immediate:!0}},methods:{change:function(t){var e=this;this.cond.cond=t,Object.keys(this.cond).forEach((function(t){"cond"!==t&&(e.cond[t]=null)}))}}},mt=bt,gt=(n("1892"),Object(j["a"])(mt,ht,pt,!1,null,null,null)),_t=gt.exports,yt={props:["objects","allDevices","init","index"],components:{ObjectBlock:Q,Cond:_t},data:function(){return{object:null,cond:null,value:null,min:null,max:null,time:null,date:null,tmsk:null,dmsk:null,time2:null,date2:null}},computed:{condition:function(){var t=this,e={};return["object","cond","value","min","max","time","date","tmsk","dmsk","time2","date2"].forEach((function(n){e[n]=t[n]})),e},initCond:function(){return this.init?{cond:this.init.cond||null,value:this.init.value||null,min:this.init.min||null,max:this.init.max||null,time:this.init.time||null,date:this.init.date||null,tmsk:this.init.tmsk||null,dmsk:this.init.dmsk||null,time2:this.init.time2||null,date2:this.init.date2||null}:null}},watch:{condition:{handler:function(t){this.$emit("change",this.clone(t))},deep:!0,immediate:!0}},methods:{change:function(t){var e=this;Object.keys(t).forEach((function(n){e[n]=t[n]}))}}},jt=yt,wt=Object(j["a"])(jt,dt,vt,!1,null,null,null),xt=wt.exports,Ct={props:["init","objects","allDevices"],components:{CustomSelect:q,Condition:xt},data:function(){return{logics:[{value:null,label:"Нет условий"},{value:"or",label:"Любое из условий"},{value:"and",label:"Весь список условий"}],logic:null,conditions:[]}},watch:{init:function(t){t&&["or","and"].includes(t.logic)&&(this.logic=t.logic,t.conditions.length&&(this.conditions=new Array(t.conditions.length).fill({})))},conditions:{handler:function(t){this.$emit("change",this.clone(t))},deep:!0},logic:function(t){t||(this.conditions=[]),this.$emit("changeLogic",t)}},methods:{addCondition:function(){this.conditions.push({})},setCondition:function(t,e){this.$set(this.conditions,t,e)},deleteCondition:function(){this.conditions.pop(),this.conditions.length||(this.logic=null)}}},kt=Ct,Ot=Object(j["a"])(kt,ut,rt,!1,null,null,null),Nt=Ot.exports,Dt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"function__row2"},[n("div",{staticClass:"function__row-name"},[t._v("Действие")]),t._l(t.actions,(function(e,i){return n("action",{key:i,attrs:{objects:t.objects,objectsForActions:t.objectsForActions,allDevices:t.allDevices,init:t.init.actions[i],index:i},on:{change:function(e){return t.setAction(i,e)}}})})),n("div",{staticClass:"function__btt1 button0",staticStyle:{"margin-top":"15px","padding-top":"10px",display:"block"},on:{click:t.addAction}},[t._v(" Добавить действие ")]),t.actions.length>1?n("div",{staticClass:"function__btt1 button0",staticStyle:{"margin-top":"15px","padding-top":"10px",display:"block"},on:{click:t.deleteAction}},[t._v(" Удалить действие ")]):t._e()],2)},Et=[],$t=(n("13d5"),[{objectTypes:["opwm","odac","var"],canBeCopied:["obin","orly","obtn","ibin","ibtn","ikey","iadc","itmp","opwm","odac","var"],acts:[{value:"set",label:"Установить",params:[{value:"value",label:"Значение"},{value:"delay",label:"Задержка"},{value:"time",label:"Время"}]},{value:"inv",label:"Инвертировать",params:[{value:"delay",label:"Задержка"},{value:"time",label:"Время"}]},{value:"mod",label:"Изменить",params:[{value:"value",label:"Значение"},{value:"delay",label:"Задержка"},{value:"time",label:"Время"}]},{value:"change",label:"Плавно изменить",params:[{value:"value",label:"Значение"},{value:"delay",label:"Задержка"},{value:"intr",label:"Время"}]},{value:"copy",label:"Копировать",params:[{value:"delay",label:"Задержка"},{value:"time",label:"Время"},{value:"source",label:"Объект"}]},{value:"icopy",label:"Копировать с инверсией",params:[{value:"delay",label:"Задержка"},{value:"time",label:"Время"},{value:"source",label:"Объект"}]}]},{objectTypes:["obin","orly","obtn"],canBeCopied:["obin","orly","obtn","ibin","ibtn","ikey","var"],acts:[{value:"set",label:"Активировать",params:[{value:"delay",label:"Задержка"},{value:"time",label:"Время"}]},{value:"reset",label:"Деактивировать",params:[{value:"delay",label:"Задержка"},{value:"time",label:"Время"}]},{value:"inv",label:"Инвертировать",params:[{value:"delay",label:"Задержка"},{value:"time",label:"Время"}]},{value:"copy",label:"Копировать",params:[{value:"delay",label:"Задержка"},{value:"time",label:"Время"},{value:"source",label:"Объект"}]},{value:"icopy",label:"Копировать с инверсией",params:[{value:"delay",label:"Задержка"},{value:"time",label:"Время"},{value:"source",label:"Объект"}]}]}]),Ft=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"function__in"},[n("object-block",{attrs:{objects:t.objectsForActions,allDevices:t.allDevices,init:t.init?t.init.object:null,index:t.index},on:{change:function(e){t.object=e}}}),n("act",{attrs:{init:t.initAct,object:t.object},on:{change:t.change}}),["copy","icopy"].includes(t.act)?n("object-block",{staticStyle:{display:"grid"},attrs:{objects:t.objectsForCopying,allDevices:t.allDevices,init:t.init&&t.init.source?t.init.source:null,index:t.index},on:{change:function(e){t.source=e}}}):t._e()],1)},At=[],St=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"act-block"},[t.acts.length?n("custom-select",{staticClass:"select1",attrs:{options:t.acts,valueInit:t.act.act,header:"Тип действия"},on:{change:t.change}}):t._e(),t._l(t.params,(function(e,i){return n("input",{directives:[{name:"tooltip",rawName:"v-tooltip",value:e.label,expression:"param.label"},{name:"model",rawName:"v-model",value:t.act[e.value],expression:"act[param.value]"}],key:i,staticClass:"inputs__inp input",attrs:{type:"text",placeholder:e.label},domProps:{value:t.act[e.value]},on:{input:function(n){n.target.composing||t.$set(t.act,e.value,n.target.value)}}})}))],2)},Tt=[],Pt={props:["init","object"],components:{CustomSelect:q},data:function(){return{act:{act:null,value:null,delay:null,time:null,source:null,intr:null},hasInput:["value","delay","time","intr"]}},computed:{action:function(){var t=this;return this.object&&this.object.type?$t.find((function(e){return e.objectTypes.includes(t.object.type)})):null},acts:function(){return this.action?this.action.acts:[]},params:function(){var t=this;if(null===this.act.act)return[];var e=this.acts.find((function(e){return e.value===t.act.act}));return e&&e.params?e.params.filter((function(e){return t.hasInput.includes(e.value)})):[]}},watch:{act:{handler:function(){var t=this;null===this.act.act&&Object.keys(this.act).forEach((function(e){t.act[e]=null}));var e=this.clone(this.act);Object.keys(e).forEach((function(t){["act","source"].includes(t)||null===e[t]||(e[t]=parseFloat(e[t]))})),this.$emit("change",e)},deep:!0},acts:function(t){var e=this;if(null!==this.act.act){var n=t.find((function(t){return t.value===e.act.act}));n&&n.value===this.act.act||(this.act.act=null)}},init:{handler:function(t){Object.assign(this.act,t)},immediate:!0}},methods:{change:function(t){var e=this;this.act.act=t,Object.keys(this.act).forEach((function(t){"act"!==t&&(e.act[t]=null)}))}}},It=Pt,Lt=(n("c594"),Object(j["a"])(It,St,Tt,!1,null,null,null)),Vt=Lt.exports,Ht={props:["objects","allDevices","init","index","objectsForActions"],components:{ObjectBlock:Q,Act:Vt},data:function(){return{object:null,act:null,value:null,delay:null,time:null,source:null,intr:null}},computed:{action:function(){var t=this,e={};return["object","act","value","delay","time","source","intr"].forEach((function(n){e[n]=t[n]})),e},initAct:function(){return this.init?{act:this.init.act||0===this.init.act?this.init.act:null,value:this.init.value||0===this.init.value?this.init.value:null,delay:this.init.delay||0===this.init.delay?this.init.delay:null,time:this.init.time||0===this.init.time?this.init.time:null,source:this.init.source||null,intr:this.init.intr||0===this.init.intr?this.init.intr:null}:null},objectsForCopying:function(){var t=this;if(!["copy","icopy"].includes(this.act))return[];if(!this.object||!this.object.type)return[];var e=$t.find((function(e){return e.objectTypes.includes(t.object.type)}));return e?this.objects.filter((function(t){return e.canBeCopied.includes(t.value)})):[]}},watch:{action:{handler:function(t){this.$emit("change",this.clone(t))},deep:!0,immediate:!0}},methods:{change:function(t){var e=this;Object.keys(t).forEach((function(n){e[n]=t[n]}))}}},Mt=Ht,Bt=Object(j["a"])(Mt,Ft,At,!1,null,null,null),Jt=Bt.exports,Wt={props:["init","objects","allDevices"],components:{Action:Jt},data:function(){return{actions:[]}},computed:{objectTypes:function(){return $t.map((function(t){return t.objectTypes})).reduce((function(t,e){return t.concat(e)}),[])},objectsForActions:function(){var t=this;return this.objects.filter((function(e){return t.objectTypes.includes(e.value)}))}},watch:{init:{handler:function(t){t.actions.length&&(this.actions=new Array(t.actions.length).fill({}))},deep:!0},actions:{handler:function(t){this.$emit("change",this.clone(t))},deep:!0}},methods:{addAction:function(){this.actions.push({})},setAction:function(t,e){this.$set(this.actions,t,e)},deleteAction:function(){this.actions.pop()}}},Zt=Wt,Rt=Object(j["a"])(Zt,Dt,Et,!1,null,null,null),Ut=Rt.exports,qt={props:["init","objects","allDevices","isVisible","name","index","hasNoFloat","ext"],components:{Trigger:ct,Conditions:Nt,Actions:Ut},data:function(){return{func:{trigger:null,conditions:[],actions:[],logic:null},err:"Произошла ошибка при попытке сохранить данную функцию, проверьте пожалуйста свой ввод и попробуйте еще раз!",disabled:!1}},watch:{shrinkTrigger:function(){}},methods:{save:function(){var t=this;if(!this.disabled){var e=this.prepareFunc();e&&f.a.post("/api/add_func".concat(this.ext),e).then((function(e){"error"!==e.data.status?t.$toasted.success("Данные успешно сохранены",{duration:3e3}):t.$toasted.error(t.err,{duration:5e3})})).catch((function(){t.$toasted.error(t.err,{duration:5e3})})).finally((function(){t.disabled=!1}))}},loadJSON:function(){if(!this.disabled){var t=this.prepareFunc();if(t){this.disabled=!1;var e=document.createElement("a"),n=JSON.stringify(t,null,4),i=new Blob([n],{type:"application/octet-stream"});e.href=URL.createObjectURL(i),e.download="function.json",e.click()}}},prepareFunc:function(){this.disabled=!0;var t=this.getClean();if(!t)return this.$toasted.error(this.err,{duration:5e3}),this.disabled=!1,!1;var e=this.transformData(t);return e},getClean:function(){var t=this.clone(this.func);null===t.logic&&(t.logic=""),t.fname=this.name;try{return t.conditions.forEach((function(e,n){Object.keys(e).forEach((function(i){null===e[i]&&delete t.conditions[n][i]})),Object.keys(e.object).forEach((function(i){null===e.object[i]&&delete t.conditions[n].object[i]}))})),t.actions.forEach((function(e,n){Object.keys(e).forEach((function(i){null===e[i]&&delete t.actions[n][i]})),Object.keys(e.object).forEach((function(i){null===e.object[i]&&delete t.actions[n].object[i]}))})),Object.keys(t.trigger).forEach((function(e){null===t.trigger[e]&&delete t.trigger[e]})),Object.keys(t.trigger.object).forEach((function(e){null===t.trigger.object[e]&&delete t.trigger.object[e]})),t}catch(e){return this.disabled=!1,!1}},transformData:function(t){var e=this,n=t;return n.trigger=this.floatToInt(n.trigger),n.conditions=n.conditions.map((function(t){return e.floatToInt(t)})),n.actions=n.actions.map((function(t){return e.floatToInt(t)})),n},floatToInt:function(t){var e=t;return this.hasNoFloat.includes(t.object.type)&&["value","min","max"].forEach((function(n){n in t&&t[n]&&(e[n]*=100)})),e}}},zt=qt,Gt=(n("b57c"),Object(j["a"])(zt,P,I,!1,null,null,null)),Kt=Gt.exports,Qt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"show",rawName:"v-show",value:t.isShown,expression:"isShown"}],staticClass:"popup1",on:{click:function(e){t.isShown=!1}}},[n("div",{staticClass:"popup__modal1"},[n("div",{staticClass:"popup__hed1"},[t._v("Добавить функцию")]),n("div",{staticClass:"popup__flex1",on:{click:function(t){t.stopPropagation()}}},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.funcName,expression:"funcName"}],staticClass:"popup__input1 input",attrs:{type:"text",placeholder:"Введите название функции"},domProps:{value:t.funcName},on:{input:function(e){e.target.composing||(t.funcName=e.target.value)}}}),n("div",{staticClass:"popup__butt1 button1",on:{click:t.add}},[t._v(" Добавить ")]),n("div",{staticClass:"popup__butt1 button1",staticStyle:{"margin-left":"5px","background-color":"red"},on:{click:function(e){t.isShown=!1}}},[t._v(" Отмена ")])])])])},Xt=[],Yt={props:["showPopupAddTrigger"],data:function(){return{isShown:!1,funcName:""}},watch:{showPopupAddTrigger:function(){this.isShown=!0}},methods:{add:function(){this.funcName.length&&(this.$emit("newFunc",this.funcName),this.isShown=!1,this.funcName="")}}},te=Yt,ee=Object(j["a"])(te,Qt,Xt,!1,null,null,null),ne=ee.exports,ie=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"show",rawName:"v-show",value:t.isShown,expression:"isShown"}],staticClass:"popup"},[n("div",{staticClass:"popup__modal"},[n("div",{staticClass:"popup__hed"},[t._v("Удалить данную функцию?")]),n("div",{staticClass:"popup__flex"},[n("div",{staticClass:"popup__button1",on:{click:function(e){t.isShown=!1}}},[t._v("Нет")]),n("div",{staticClass:"popup__button2",on:{click:t.del}},[t._v("Да")])])])])},ae=[],le={props:["showPopupDelTrigger","index"],data:function(){return{isShown:!1}},watch:{showPopupDelTrigger:function(){this.isShown=!0}},methods:{del:function(){this.$emit("del",this.index),this.isShown=!1}}},se=le,oe=Object(j["a"])(se,ie,ae,!1,null,null,null),ce=oe.exports,ue={components:{EditImg:C,DeleteImg:E,ExpandImg:T,Function:Kt,PopupAdd:ne,PopupDelete:ce},data:function(){return{funcsNames:[],funcsInit:[],objects:[],allDevices:[],canApply:!1,hasComplexAddr:m["a"],visibility:{},showPopupAddTrigger:null,showPopupDelTrigger:null,deleteFuncIndex:null,hasNoFloat:g["a"],ext:""}},created:function(){var t=this;f.a.post("/api/get_flist".concat(this.ext)).then((function(e){t.funcsNames=e.data.func_names,t.funcsInit=new Array(e.data.func_names.length).fill(null),t.getAllFuncs()})),f.a.post("/api/devlist".concat(this.ext)).then((function(e){var n=t.clone(b);e.data.devices.forEach((function(e){var i=t.clone(e);n.forEach((function(t,i){t.devName in e&&e[t.devName]>0&&("devices"in t||(n[i].devices=[]),n[i].devices.push({value:e.addr,label:e.addr}))})),t.hasComplexAddr.forEach((function(t){delete i[t]})),t.getDevice(i)})),t.objects=n.filter((function(t){return t.devices||["var","time"].includes(t.value)})),t.canApply=!0}))},methods:{getAllFuncs:function(){var t=this;this.funcsNames.forEach((function(e,n){t.getFunc(n)}))},getFunc:function(t){var e=this;f.a.post("/api/get_func".concat(this.ext),{function:t}).then((function(n){var i=e.transformData(n.data);e.$set(e.funcsInit,t,i)}))},getDevice:function(t){this.allDevices.push(t),this.getWireAddresses(t,this.allDevices.length-1)},getWireAddresses:function(t,e){var n=this;f.a.post("/api/get_wlist".concat(this.ext),{device:t.addr}).then((function(i){var a=i.data;f.a.post("/api/get_label".concat(n.ext),{device:t.addr}).then((function(t){var i=t.data;n.hasComplexAddr.forEach((function(t){if(a[t]&&a[t].length){var l=a[t].map((function(e,n){return{value:e,label:i[t]&&i[t][n]&&i[t][n].length?i[t][n]:e}}));n.$set(n.allDevices[e],t,l)}else n.$set(n.allDevices[e],t,[])}));var l={};Object.keys(i).forEach((function(t){n.hasComplexAddr.includes(t)||"device"===t||(l[t]=i[t])})),n.$set(n.allDevices[e],"label",l)}))}))},toggleVisibility:function(t){var e=t.fname;e in this.visibility?this.visibility[e]=!this.visibility[e]:this.$set(this.visibility,e,!0)},openAddPopup:function(){this.showPopupAddTrigger=Math.random()},addFunc:function(t){var e=this;this.funcsNames.push(t),this.funcsInit.push({fname:t,trigger:{},logic:null,conditions:[],actions:[]}),setTimeout((function(){e.funcsInit[e.funcsInit.length-1].actions.push({}),e.visibility=Object(h["a"])({},t,!0),setTimeout((function(){window.scrollTo(0,document.body.scrollHeight)}),0)}),0)},showPopupDel:function(t){this.deleteFuncIndex=t,this.showPopupDelTrigger=Math.random()},delFunc:function(t){var e=this;f.a.post("/api/get_flist".concat(this.ext),{function:t}).then((function(n){var i=n.data.func_names.findIndex((function(n){return n===e.funcsNames[t]}));f.a.post("/api/del_func".concat(e.ext),{function:i}).then((function(){e.$set(e.funcsInit[t],"isDeleted",!0)}))}))},transformData:function(t){var e=this,n=t;return n.trigger=this.intToFloat(n.trigger),n.conditions=n.conditions.map((function(t){return e.intToFloat(t)})),n.actions=n.actions.map((function(t){return e.intToFloat(t)})),n},intToFloat:function(t){var e=t;return this.hasNoFloat.includes(t.object.type)&&["value","min","max"].forEach((function(n){n in t&&t[n]&&(e[n]/=100)})),e}}},re=ue,de=Object(j["a"])(re,d,v,!1,null,null,null),ve=de.exports,he={name:"App",components:{LeftSideBar:u["a"],HeaderComp:r["a"],Functions:ve}},pe=he,fe=Object(j["a"])(pe,o,c,!1,null,null,null),be=fe.exports;i["a"].config.productionTip=!1,i["a"].use(a["a"],{defaultTrigger:"hover"}),i["a"].use(s.a,{keepOnHover:!0}),i["a"].mixin({methods:{clone:function(t){return JSON.parse(JSON.stringify(t))}}}),new i["a"]({render:function(t){return t(be)}}).$mount("#app")},"65d3":function(t,e,n){"use strict";n("ec0b")},"9afe":function(t,e,n){},b57c:function(t,e,n){"use strict";n("9afe")},b989:function(t,e,n){},c594:function(t,e,n){"use strict";n("fbfe")},ec0b:function(t,e,n){},fbfe:function(t,e,n){}});